<?xml version="1.0"?>
<robot name="car"  xmlns:xacro="http://www.ros.org/wiki/xacro">

  <!-- Parameters -->

  <!-- Size factors -->
  <xacro:property name="k_overall" value="0.1" />   <!-- Overall size factor (0.1)-->
  <xacro:property name="k_car" value="${10*k_overall}" />   <!-- Car size factor (10)-->
  <xacro:property name="a_base" value="${5*2*k_overall}" />  <!-- Base side length (2) -->
  <xacro:property name="r_circle" value="${7*0.5*k_overall}" />  <!-- Circle radius (0.5) -->
  <xacro:property name="h_h" value="1" /> <!-- H size factor (if 1, height = r_circle)-->
  <xacro:property name="h_w" value="1" /> <!-- H width factor (1)-->
  <xacro:property name="t" value="${0.001}" /> <!-- H font thickness (0.005) -->
  <!-- Caution! too small t value can make H invisible in PyBullet -->

  <!-- Base and circle color codes -->

  <!-- Color for PyBullet and RViz --> 
  <material name="base_color">
    <color rgba="0.0 1.0 0.0 1.0"/>
  </material>

  <material name="circle_color">
    <color rgba="1.0 1.0 1.0 1.0"/>
  </material>

  <!-- Color for Gazebo --> 
  <xacro:macro name="base_color_gazebo">
    <visual>  
      <material>  
        <ambient>0 0 1 1.0</ambient>  
        <diffuse>0 0.5 0 1.0</diffuse>  
        <specular>0 0 0 1.0</specular>  
        <emissive>0.0 0.0 0.0 0.0</emissive>  
     </material>  
    </visual> 
  </xacro:macro>

  <xacro:macro name="circle_color_gazebo">
    <visual>  
      <material>  
        <ambient>0 0 0.5 1.0</ambient>  
        <diffuse>1 1 1 1.0</diffuse>  
        <specular>0 0 0 1.0</specular>  
        <emissive>0.0 0.0 0.0 0.0</emissive>  
     </material>  
    </visual> 
  </xacro:macro>

  <!-- End of parameters -->

  <xacro:macro name="wheel">
    <inertial>
      <mass value="${0.01*k_car**3}"/>
      <origin xyz="0 0 0"/>
      <inertia 
        ixx="0.1" ixy="0.0" ixz="0.0" 
        iyy="0.1" iyz="0.0" 
        izz="0.1"/>
    </inertial>
    <visual>
      <origin rpy="${pi/2} 0 0" xyz="0 0 0"/>
      <geometry>
        <cylinder length="${0.025*k_car}" radius="${0.06*k_car}"/>
      </geometry>
      <material name="Black"/>
    </visual>
    <collision>
      <origin rpy="${pi/2} 0 0" xyz="0 0 0"/>
      <geometry>
        <cylinder length="${0.025*k_car}" radius="${0.06*k_car}"/>
      </geometry>
    </collision>
  </xacro:macro>

  <material name="Red">
    <color rgba="1.0 0 0 1.0"/>
  </material>
  <material name="Green">
    <color rgba="0 1.0 0 1.0"/>
  </material>
  <material name="Blue">
    <color rgba="0 0 1.0 0.5"/>
  </material>
  <material name="Black">
    <color rgba="0 0 0 1.0"/>
  </material>

  <!-- Dummy base link to lift the base up -->

  <link name="base_link">
    <inertial>
      <mass value="${0.2*k_car**3}"/>
      <origin xyz="0 0 0"/>
      <inertia 
        ixx="${0.02*k_car**5}" ixy="0.0" ixz="0.0" 
        iyy="${0.02*k_car**5}" iyz="0.0" 
        izz="${0.02*k_car**5}"/>
    </inertial>
  </link>

  <!-- Main body -->
  <link name="main_body">
    <inertial>
      <mass value="${0.2*k_car**3}"/>
      <origin xyz="0 0 0"/>
      <inertia 
        ixx="${0.02*k_car**5}" ixy="0.0" ixz="0.0" 
        iyy="${0.02*k_car**5}" iyz="0.0" 
        izz="${0.02*k_car**5}"/>
    </inertial>
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="${0.3*k_car} ${0.15*k_car} ${0.1*k_car}"/>
      </geometry>
      <material name="Red"/>
    </visual>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="${0.3*k_car} ${0.15*k_car} ${0.1*k_car}"/>
      </geometry>
    </collision>
  </link>

  <gazebo reference="main_body">
    <material>Gazebo/Red</material>
  </gazebo>

  <joint name="dummy" type="fixed">
    <parent link="base_link"/>
    <child link="main_body"/>
    <origin rpy='0 0 0' xyz='0 0 ${0.16*k_car}'/>
  </joint>

  <!-- the rear wheel bar -->
  <link name="rear_bar_link">
    <visual>
      <origin xyz="0 0 0"/>
      <geometry>
        <cylinder radius="${0.01*k_car}" length="${0.175*k_car}"/>
      </geometry>
      <material name="Green"/>
    </visual>
   <inertial>
      <mass value="${0.01*k_car**3}"/>
      <origin xyz="0 0 0"/>
      <inertia 
        ixx="${0.01*k_car**5}" ixy="0.0" ixz="0.0" 
        iyy="${0.01*k_car**5}" iyz="0.0" 
        izz="${0.01*k_car**5}"/>
    </inertial>
    <collision>
      <origin xyz="0 0 0"/>
      <geometry>
        <cylinder radius="${0.01*k_car}" length="${0.2*k_car}"/>
      </geometry>
    </collision>
  </link>

  <gazebo reference="rear_bar_link">
    <material>Gazebo/Green</material>
  </gazebo>

  <joint name="rear_bar_joint" type="continuous">
    <axis xyz="0 0 1"/>
    <parent link="main_body"/>
    <child link="rear_bar_link"/>
    <origin rpy="${-pi/2} 0 0" xyz="${-0.16*k_car} 0.0 ${-0.1*k_car}"/>
  </joint>

  <!-- the back left wheel -->
  <link name="back_left_wheel_link">
    <xacro:wheel/>
  </link>

  <gazebo reference="back_left_wheel_link">
    <material>Gazebo/Black</material>
  </gazebo>

  <joint name="back_left_wheel_joint" type="fixed">
    <axis xyz="0 1 0"/>
    <parent link="rear_bar_link"/>
    <child link="back_left_wheel_link"/>
    <origin rpy="${pi/2} 0 0" xyz="0.0 0.0 ${0.1*k_car}"/>
  </joint>

  <!-- the back right wheel -->
  <link name="back_right_wheel_link">
    <xacro:wheel/>
  </link>

  <gazebo reference="back_right_wheel_link">
    <material>Gazebo/Black</material>
  </gazebo>

  <joint name="back_right_wheel_joint" type="fixed">
    <axis xyz="0 1 0"/>
    <parent link="rear_bar_link"/>
    <child link="back_right_wheel_link"/>
    <origin rpy="${pi/2} 0 0" xyz="0.0 0.0 ${-0.1*k_car}"/>
  </joint>

  <!-- The below code is for connected front wheels -->

  <!-- the front wheel bar -->
  <link name="bar_link">
    <visual>
      <origin xyz="0 0 0"/>
      <geometry>
        <cylinder radius="${0.01*k_car}" length="${0.175*k_car}"/>
      </geometry>
      <material name="Green"/>
    </visual>
   <inertial>
      <mass value="${0.01*k_car**3}"/>
      <origin xyz="0 0 0"/>
      <inertia 
        ixx="${0.01*k_car**5}" ixy="0.0" ixz="0.0" 
        iyy="${0.01*k_car**5}" iyz="0.0" 
        izz="${0.01*k_car**5}"/>
    </inertial>
    <collision>
      <origin xyz="0 0 0"/>
      <geometry>
        <cylinder radius="${0.01*k_car}" length="${0.2*k_car}"/>
      </geometry>
    </collision>
  </link>

  <gazebo reference="bar_link">
    <material>Gazebo/Green</material>
  </gazebo>

  <joint name="bar_joint" type="continuous">
    <axis xyz="0 0 1"/>
    <parent link="main_body"/>
    <child link="bar_link"/>
    <origin rpy="${-pi/2} 0 0" xyz="${0.16*k_car} 0.0 ${-0.1*k_car}"/>
  </joint>

  <!-- the front left wheel -->
  <link name="front_left_wheel_link">
    <xacro:wheel/>
  </link>

  <gazebo reference="front_left_wheel_link">
    <material>Gazebo/Green</material>
  </gazebo>

  <joint name="front_left_wheel_joint" type="fixed">
    <parent link="bar_link"/>
    <child link="front_left_wheel_link"/>
    <origin rpy="${pi/2} 0 0" xyz="0.0 0.0 ${-0.1*k_car}"/>
  </joint>

  <!-- the front right wheel -->
  <link name="front_right_wheel_link">
    <xacro:wheel/>
  </link>

  <gazebo reference="front_right_wheel_link">
    <material>Gazebo/Green</material>
    <turnGravityOff>false</turnGravityOff>
  </gazebo>

  <joint name="front_right_wheel_joint" type="fixed">
    <parent link="bar_link"/>
    <child link="front_right_wheel_link"/>
    <origin rpy="${pi/2} 0 0" xyz="0.0 0.0 ${0.1*k_car}"/>
  </joint>

  <!-- the heliport holder -->
  <link name="holder">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <cylinder radius="${0.005*k_car}" length="${0.05*k_car}"/>
      </geometry>
      <material name="Black"/>
    </visual>
    <inertial>
      <mass value="${0.01*k_car**3}"/>
      <origin xyz= "0 0 0"/>
      <inertia
        ixx="${0.05*k_car**5}" ixy="0.0" ixz="0.0" 
        iyy="${0.05*k_car**5}" iyz="0.0" 
        izz="${0.05*k_car**5}"/>
      </inertial>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <cylinder radius="${0.005*k_car}" length="${0.05*k_car}"/>
      </geometry>
    </collision>
  </link>

  <gazebo reference="holder">
    <material>Gazebo/Black</material>
  </gazebo>


  <joint name="base_to_holder" type="fixed">
    <parent link="main_body"/>
    <child link="holder"/>
    <origin rpy="0 0 0" xyz="0 0 ${0.075*k_car}"/>
  </joint>

  <!-- The heliport base -->
  <link name="heliport_base">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="${a_base} ${a_base} ${0.025*a_base}"/>
      </geometry>
      <material name="base_color"/>
    </visual>
    <inertial>
      <mass value="${0.05*a_base**3}"/>
      <origin xyz= "0 0 0"/>
      <inertia
        ixx="${0.009*a_base**5}" ixy="0.0" ixz="0.0" 
        iyy="${0.009*a_base**5}" iyz="0.0" 
        izz="${0.009*a_base**5}"/>
      </inertial>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="${a_base} ${a_base} ${0.025*a_base}"/>
      </geometry>
    </collision>
  </link>

  <gazebo reference="heliport_base">
    <!-- <material>Gazebo/Green</material> -->
    <xacro:base_color_gazebo/>
  </gazebo>

  <joint name="holder_to_heliport" type="fixed">
    <parent link="holder"/>
    <child link="heliport_base"/>
    <origin rpy="0 0 0" xyz="0 0 ${0.025*k_car+0.0125*a_base}"/>
  </joint>

  <!-- the heliport circle -->
  <link name="heliport_circle">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <cylinder radius="${r_circle}" length="${t}"/>
      </geometry>
      <material name="circle_color"/>
    </visual>
    <inertial>
      <mass value="0.00001"/>
      <origin xyz= "0 0 0"/>
      <inertia
        ixx="0.00001" ixy="0.0" ixz="0.0" 
        iyy="0.00001" iyz="0.0" 
        izz="0.00001"/>
      </inertial>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <cylinder radius="${r_circle}" length="${t}"/>
      </geometry>
    </collision>
  </link>

  <gazebo reference="heliport_circle">
    <!-- <material>Gazebo/Red</material> -->
    <xacro:circle_color_gazebo/>
  </gazebo>

  <joint name="heliport_base_to_circle" type="fixed">
    <parent link="heliport_base"/>
    <child link="heliport_circle"/>
    <origin rpy="0 0 0" xyz="0 0 ${0.0125*a_base+t/2}"/>
  </joint>

  <!-- left arm of H-->
  <link name="H_left">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="${r_circle*h_h} ${r_circle*h_w/4.25} ${t}"/>
      </geometry>
      <material name="Black"/>
    </visual>
    <inertial>
      <mass value="0.00001"/>
      <origin xyz= "0 0 0"/>
      <inertia
        ixx="0.00001" ixy="0.0" ixz="0.0" 
        iyy="0.00001" iyz="0.0" 
        izz="0.00001"/>
      </inertial>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="${r_circle*h_h} ${r_circle*h_w/4.25} ${t}"/>
      </geometry>
    </collision>
  </link>

  <gazebo reference="H_left">
    <material>Gazebo/Black</material>
  </gazebo>

  <joint name="H_left_to_circle" type="fixed">
    <parent link="heliport_circle"/>
    <child link="H_left"/>
    <origin rpy="0 0 0" xyz="0 ${r_circle*h_w*1.4/3.4} ${t}"/>
  </joint>

  <!-- right arm of H-->
  <link name="H_right">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="${r_circle*h_h} ${r_circle*h_w/4.25} ${t}"/>
      </geometry>
      <material name="Black"/>
    </visual>
    <inertial>
      <mass value="0.00001"/>
      <origin xyz= "0 0 0"/>
      <inertia
        ixx="0.00001" ixy="0.0" ixz="0.0" 
        iyy="0.00001}" iyz="0.0" 
        izz="0.00001}"/>
      </inertial>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="${r_circle*h_h} ${r_circle*h_w/4.25} ${t}"/>
      </geometry>
    </collision>
  </link>

  <gazebo reference="H_right">
    <material>Gazebo/Black</material>
  </gazebo>

  <joint name="H_right_to_circle" type="fixed">
    <parent link="heliport_circle"/>
    <child link="H_right"/>
    <origin rpy="0 0 0" xyz="0 -${r_circle*h_w*1.4/3.4} ${t}"/>
  </joint>

  <!-- middle of H-->
  <link name="H_middle">
    <visual>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="${r_circle*h_h*0.8/3.4} ${r_circle*h_w*2.0/3.4} ${t}"/>
      </geometry>
      <material name="Black"/>
    </visual>
    <inertial>
      <mass value="0.00001"/>
      <origin xyz= "0 0 0"/>
      <inertia
        ixx="0.00001" ixy="0.0" ixz="0.0" 
        iyy="0.00001}" iyz="0.0" 
        izz="0.00001}"/>
      </inertial>
    <collision>
      <origin rpy="0 0 0" xyz="0 0 0"/>
      <geometry>
        <box size="${r_circle*h_h*0.8/3.4} ${r_circle*h_w*2.0/3.4} ${t}"/>
      </geometry>
    </collision>
  </link>

  <gazebo reference="H_middle">
    <material>Gazebo/Black</material>
  </gazebo>

  <joint name="H_middle_to_circle" type="fixed">
    <parent link="heliport_circle"/>
    <child link="H_middle"/>
    <origin rpy="0 0 0" xyz="0 0 ${t}"/>
  </joint>




  <gazebo>
    <plugin name="object_controller" filename="libgazebo_ros_planar_move.so">
      <commandTopic>cmd_vel</commandTopic>
      <odometryTopic>odom</odometryTopic>
      <odometryFrame>odom</odometryFrame>
      <odometryRate>20.0</odometryRate>
      <robotBaseFrame>bar_link</robotBaseFrame>
    </plugin>
  </gazebo>






  <!-- The below code is for free front wheels -->

  <!-- the front left wheel -->
  <!--   <joint name="front_left_wheel_joint" type="continuous">
    <axis xyz="0 1 0"/>
    <parent link="main_body"/>
    <child link="front_left_wheel_link"/>
    <origin rpy="0 0 0" xyz="0.16 0.1 -0.1"/>
  </joint>

  <link name="front_left_wheel_link">
    <xacro:wheel/>
  </link>

  <gazebo reference="front_left_wheel_link">
    <material>Gazebo/Green</material>
  </gazebo> -->

  <!-- the front right wheel -->
<!--   <joint name="front_right_wheel_joint" type="continuous">
    <axis xyz="0 1 0"/>
    <parent link="main_body"/>
    <child link="front_right_wheel_link"/>
    <origin rpy="0 0 0" xyz="0.16 -0.1 -0.1"/>
  </joint>
  <link name="front_right_wheel_link">
    <xacro:wheel/>
  </link>
  <gazebo reference="front_right_wheel_link">
    <material>Gazebo/Green</material>
    <turnGravityOff>false</turnGravityOff>
  </gazebo> -->


</robot>


